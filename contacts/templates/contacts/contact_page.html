{% extends 'base.html' %}

{% load wagtailcore_tags %}
{% comment %}
By default Django localizes floats ang this fails Google Maps.
We use this tag to unlocalize latitude and longitude.
{% endcomment %}
{% load l10n %}


{% block page_name %}Контакты{% endblock %}

{% block content %}
    <div class="container margin-top">
        <div class="row">
            <div class="col-12 col-md-8">
                {{ page.body | richtext }}
            </div>
            <div class="col-12 col-md-4">
                <h5>Адрес:</h5>
                <p>{{ page.address }}</p>

                <h5>E-mail:</h5>
                <p>{{ page.email }}</p>

                <h5>Телефоны:</h5>
                <p>
                    {% for item in page.phones.all %}
                        {{ item.to_str }}<br>
                    {% endfor %}
                </p>

            </div>
        </div>
        <div class="row">
            <div class="col-12" id="map">

            </div>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
    <script>
      function initMap() {
        var uluru = {% templatetag openbrace %}
            lat: {{ page.latitude | unlocalize}},
            lng: {{ page.longitude | unlocalize}}
                {% templatetag closebrace %};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 17,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map
        });
      }
    </script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_API_KEY }}&callback=initMap">
    </script>

{% endblock extra_js %}